---
title: "Dynamic Report"
output: html_document
params:
  conceptId: NULL
  CDMdbHandler: NULL
  showsMappings: FALSE
---

```{r setup, include=FALSE}
# Set dynamic title based on conceptId parameter
if (!is.null(params$conceptId)) {
  title <- paste("Concept ID:", params$conceptId)
} else {
  title <- "Dynamic Report"
}
```

# `r title`
  
```{r}
results <- getCodeCounts(
  params$CDMdbHandler,
  conceptId = params$conceptId  |> as.integer()
)

``` 


Graph
```{r}
mermaid <- createMermaidGraphFromResults(results, showsMappings = params$showsMappings)
DiagrammeR::mermaid(mermaid, width = "100%", height = "100%")
```

Table
```{r}
createCodeCountsTableFromResults(results)
``` 

Plot
```{r}
createPlotFromResults(results)
``` 


<!-- Load mermaid.js -->
<script src="mermaid.min.js"></script>
<script>
mermaid.initialize({ startOnLoad: true });
</script>

